
<!-- saved from url=(0077)http://www.teach.cs.toronto.edu/~csc209h/winter/labs/lab5-fileio-structs.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"></head><body><h1 id="lab-5-file-io-and-structs">Lab 5: File I/O and Structs</h1>
<p><strong>Due date</strong>: Friday 9 February before 6:30pm.</p>
<h2 id="introduction">Introduction</h2>
<p>The purpose of this lab is to give you some practice using structs and reading binary data from files. To get started, run a <code>git pull</code> in your repository to download the lab 5 starter code.</p>
<p>We've provided the Makefile for this lab; you shouldn't need to change it. Simply run <code>make</code> to compile the program.</p>
<h3 id="introduction-bitmap-files">Introduction: Bitmap files</h3>
<p>A <em>24-bit bitmap file</em> is a simple image file format that consists of two main parts:</p>
<ol style="list-style-type: decimal">
<li>The file metadata.</li>
<li>The <em>pixel array</em>, storing numbers corresponding to the blue, green, and red colour values of each pixel in the image (as a number between 0 and 255).</li>
</ol>
<p>(Note: the actual file format consists of an optional third section after the pixel array, but we'll ignore that section for the purpose of this lab.)</p>
<p>At fixed locations in the file metadata, there are three important integers (each stored with exactly 4 bytes):</p>
<ul>
<li>At byte offset 10-13, the offset in the bitmap file where the pixel array starts.</li>
<li>At byte offset 18-21, the width of the image, in pixels.</li>
<li>At byte offset 22-25, the height of the image, in pixels.</li>
</ul>
<p>Suppose our bitmap image has height m and width n; we'll always assume in this lab that the width n is a multiple of 4, which simplifies the byte layout in the file a little. For this image, the pixel array stores exactly 3nm bytes, in the following way:</p>
<ul>
<li>Each group of 3 bytes represents a single pixel, where the bytes store the blue, green, and red colour values of the pixel, in that order.</li>
<li>Pixels are grouped by row. For example, the first 3n bytes in the pixel array represent the pixels in the top-most row of the image.</li>
</ul>
<p>That's all you need for this lab, but if you're curious about learning more about the bitmap file format, you can start <a href="https://en.wikipedia.org/wiki/BMP_file_format">here</a>.</p>
<h3 id="task-1-reading-bitmap-metadata">Task 1: Reading bitmap metadata</h3>
<p>In the starter code, we have provided a <code>main</code> function in <code>bitmap_printer.c</code> that opens a bitmap file for processing, and a separate file <code>bitmap.c</code> that implements the required functions for working with bitmaps.</p>
<p>Your first task is to use the description of the bitmap metadata to implement <code>read_bitmap_metadata</code>. Don't just try to read in the entire bitmap file! Use <code>fseek</code> to navigate to different byte locations so that you only read in the three required integers.</p>
<p>We've provided in the starter code two sample bitmap files you can use to test your work. It's quite possible for you to go out and find your own bitmap images, but beware that there are many variations of this file format, and we're only covering the <strong>24-bit</strong> version in this lab, so you might need to convert new images to this format yourself (and crop to ensure the width is a multiple of 4).</p>
<h3 id="task-2-reading-in-pixels">Task 2: Reading in pixels</h3>
<p>Now, you'll read in all of the pixels into memory, using a common pattern for storing a two-dimensional array on the heap. Read through the comments in the starter code carefully to complete this part.</p>
<p>Note that because each pixel colour value (blue, green, or red) is stored in just one byte, the type we use is <code>unsigned char</code>, which is guaranteed to represent the numbers 0-255.</p>
<h3 id="task-3-cleaning-up">Task 3: Cleaning up</h3>
<p>Don't forget about tidying up the program's resources! Add some code to the bottom of the <code>main</code> function in <code>bitmap_printer.c</code> to close the bitmap file and free all of the program's dynamically-allocated memory.</p>
</body></html>